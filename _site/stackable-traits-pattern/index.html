<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="A blog about backend development, Scala, Java and devOps">

    <title>Stackable Traits pattern - Part 1 | Dani</title>

    <link rel="canonical" href="http://localhost:4000/stackable-traits-pattern/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/clean-blog.css">

    <!-- Pygments Github CSS -->
    <link rel="stylesheet" href="/css/syntax.css">

    <!-- Custom Fonts -->
    <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- facebook Open Graph Metadatas -->
    <meta content="609039549219229" property="fb:app_id">
    <meta content="FullGC" property="og:site_name">
    
      <meta content="Stackable Traits pattern - Part 1" property="og:title">
    
    
      <meta content="article" property="og:type">
    
    
      <meta content="A blog about backend development, Scala, Java and devOps" property="og:description">
    
    
      <meta content="http://localhost:4000/stackable-traits-pattern/" property="og:url">
    
    
      <meta content="2017-12-08T16:40:45+02:00" property="article:published_time">
      <meta content="http://localhost:4000/about/" property="article:author">
    
    
      <meta content="http://localhost:4000/img/burger-stack.jpg" property="og:image">
    
    
      
    
    
      
      <meta content="scala" property="article:tag">
      
      <meta content="stackable" property="article:tag">
      
      <meta content="traits" property="article:tag">


    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-57009102-1', 'auto');
  ga('send', 'pageview');

</script>
    {% seo %}
</head>

<!-- Begin Jekyll SEO tag v2.3.0 -->
<title>Stackable Traits pattern - Part 1 | FullGC</title>
<meta property="og:title" content="Stackable Traits pattern - Part 1" />
<meta name="author" content="Dani Shemesh" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="This post is the first of a two parts series of articles on Stackable Traits" />
<meta property="og:description" content="This post is the first of a two parts series of articles on Stackable Traits" />
<link rel="canonical" href="http://localhost:4000/stackable-traits-pattern/" />
<meta property="og:url" content="http://localhost:4000/stackable-traits-pattern/" />
<meta property="og:site_name" content="FullGC" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2017-12-08T16:40:45+02:00" />
<script type="application/ld+json">
{"name":null,"description":"This post is the first of a two parts series of articles on Stackable Traits","author":{"@type":"Person","name":"Dani Shemesh"},"@type":"BlogPosting","url":"http://localhost:4000/stackable-traits-pattern/","publisher":null,"image":null,"headline":"Stackable Traits pattern - Part 1","dateModified":"2017-12-08T16:40:45+02:00","datePublished":"2017-12-08T16:40:45+02:00","sameAs":null,"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/stackable-traits-pattern/"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

<body>

    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Dani Shemesh</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="/">Home</a>
                </li>
                
                <li>
                    <a href="/about/">About</a>
                </li>
                
                <li>
                    <a href="/contact/">Contact</a>
                </li>
                
                <li>
                    
                </li>
                
                <li>
                    
                </li>
                
                <li>
                    
                </li>
                
                <li>
                    
                </li>
                
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>


    <!-- Post Header -->
<header class="intro-header" style="background-image: url('/img/burger-stack.jpg')">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <h1>Stackable Traits pattern - Part 1</h1>
                    
                    <span class="meta">Posted by Dani Shemesh on December 8, 2017</span>
                </div>
            </div>
        </div>
    </div>
    <!-- Begin Jekyll SEO tag v2.3.0 -->
<title>Stackable Traits pattern - Part 1 | FullGC</title>
<meta property="og:title" content="Stackable Traits pattern - Part 1" />
<meta name="author" content="Dani Shemesh" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="This post is the first of a two parts series of articles on Stackable Traits" />
<meta property="og:description" content="This post is the first of a two parts series of articles on Stackable Traits" />
<link rel="canonical" href="http://localhost:4000/stackable-traits-pattern/" />
<meta property="og:url" content="http://localhost:4000/stackable-traits-pattern/" />
<meta property="og:site_name" content="FullGC" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2017-12-08T16:40:45+02:00" />
<script type="application/ld+json">
{"name":null,"description":"This post is the first of a two parts series of articles on Stackable Traits","author":{"@type":"Person","name":"Dani Shemesh"},"@type":"BlogPosting","url":"http://localhost:4000/stackable-traits-pattern/","publisher":null,"image":null,"headline":"Stackable Traits pattern - Part 1","dateModified":"2017-12-08T16:40:45+02:00","datePublished":"2017-12-08T16:40:45+02:00","sameAs":null,"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/stackable-traits-pattern/"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">

				      <p><i>This post is the first of a two parts series of articles on Stackable Traits</i></p>

<ul>
  <li><a href="https://fullgc.github.io/stackable-traits-pattern/">Part-1: Error reporting design with Stackable Traits</a></li>
  <li><a href="https://fullgc.github.io/stackable-traits-pattern---part-2/">Part-2: Gathering Metrics with Stackable Actors</a></li>
</ul>

<p><em>“Traits let you modify the methods of a class, and they do so in a way that allows you to stack those modifications with each other” (Programming in Scala by Martin Odersky)</em></p>

<p>One of the reasons that Scala still feels to me as ‘a better Java’, is the power of its traits. Trait can be used for multiple inheritance as Java interface, as a rich interface with fields and a state, and to be mixed into a class.</p>

<p>An interesting behavior of traits, as opposed to classes, is the call for a super method. Call for a super method in classes is statically bound, means that the exact implementation that would be invoked is known upfront. In traits however it is dynamically bound. The term is usually refers to an invocation of a method in an object, where the implementation is decided on runtime, i.e. a polymorphic call. The super call is not defined when a trait defined, but only when it is mixed into a concrete class. This behavior allows us to ‘stack’ the traits, and used them the super call as ‘pipe’ and redirect output, quite similar to ‘pipe’ in linux. This is the basis for the use-cases we’ll review.</p>

<p><img align="right" src="/img/stackable_narrative.png" /></p>
<h2 id="part-1-error-reporting-design">Part-1: Error reporting design</h2>

<p>Consider the following:</p>

<p>An Ad-Server gets a request for an Advertisement from a mobile phone.</p>

<p>Here we’ll discuss a solution for executing the actions that need to be taken when the Ad-Server encounter errors. There are 2 types of errors which should be handled appropriately as follows:</p>

<p>On <strong>FatalError</strong>:</p>

<ol>
  <li>
    <p>The Logger <em>prints</em> to the Log</p>
  </li>
  <li>
    <p>The Monitor <em>increments</em> the counter Metric.</p>
  </li>
  <li>
    <p>Kafka-Producer <em>sends</em> a Json Event with a timestamp  to Kafka.</p>
  </li>
  <li>
    <p><em>when step 3 failed</em>, S3-Client <em>uploads</em> the Event as CSV with a timestamp to to S3 (backup)</p>
  </li>
</ol>

<p>On <strong>InvalidRequestError</strong></p>

<ol>
  <li>
    <p>The Logger <em>prints</em> to the Log</p>
  </li>
  <li>
    <p>The Monitor <em>increments</em> the counter Metric.</p>
  </li>
  <li>
    <p>Kafka-Producer <em>sends</em> a Json Event to Kafka.</p>
  </li>
</ol>

<p>An Error has a code, a description, and unique properties</p>

<!-- HTML generated using hilite.me -->
<div style="background: #f0f0f0; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #007020; font-weight: bold">trait</span> <span style="color: #0e84b5; font-weight: bold">ServingError</span><span style="color: #666666">{</span>
 <span style="color: #007020; font-weight: bold">val</span> code<span style="color: #007020; font-weight: bold">:</span> <span style="color: #902000">Int</span>
 <span style="color: #007020; font-weight: bold">val</span> description<span style="color: #007020; font-weight: bold">:</span> <span style="color: #902000">String</span>
<span style="color: #666666">}</span>
<span style="color: #007020; font-weight: bold">case</span> <span style="color: #007020; font-weight: bold">class</span> <span style="color: #0e84b5; font-weight: bold">FatalError</span><span style="color: #666666">(</span><span style="color: #007020; font-weight: bold">override</span> <span style="color: #007020; font-weight: bold">val</span> code<span style="color: #007020; font-weight: bold">:</span> <span style="color: #902000">Int</span> <span style="color: #666666">=</span> <span style="color: #40a070">1</span><span style="color: #666666">,</span> exceptionCause<span style="color: #007020; font-weight: bold">:</span> <span style="color: #902000">String</span><span style="color: #666666">)</span> <span style="color: #007020; font-weight: bold">extends</span> <span style="color: #0e84b5; font-weight: bold">ServingError</span> <span style="color: #666666">{</span>
 <span style="color: #007020; font-weight: bold">override</span> <span style="color: #007020; font-weight: bold">val</span> description<span style="color: #007020; font-weight: bold">:</span> <span style="color: #902000">String</span> <span style="color: #666666">=</span>  s<span style="color: #4070a0">&quot;Fatal Error code $code accrued</span>
<span style="color: #4070a0">}</span>
<span style="color: #4070a0">case class InvalidRequestError(paramName: String, paramValue: String, override val code: Int = 2) extends ServingError{</span>
<span style="color: #4070a0"> override val description: String = s&quot;</span><span style="color: #0e84b5; font-weight: bold">Invalid</span> <span style="color: #0e84b5; font-weight: bold">Request</span><span style="color: #666666">.</span> <span style="color: #0e84b5; font-weight: bold">Bad</span>  parameter<span style="color: #007020; font-weight: bold">:</span> <span style="color: #902000">$paramName</span><span style="border: 1px solid #FF0000">&quot;</span> <span style="color: #902000">+</span> <span style="border: 1px solid #FF0000">&quot;</span> <span style="border: 1px solid #FF0000">&quot;</span> <span style="color: #902000">+</span> <span style="color: #902000">s</span><span style="border: 1px solid #FF0000">&quot;</span><span style="color: #902000">with</span> <span style="color: #902000">value:</span> <span style="color: #902000">$paramValue</span><span style="border: 1px solid #FF0000">&quot;</span>
<span style="color: #666666">}</span>
</pre></div>

<p>And these are mocks for the Scala Clients</p>

<!-- HTML generated using hilite.me -->
<div style="background: #f0f0f0; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #007020; font-weight: bold">object</span> <span style="color: #0e84b5; font-weight: bold">KafkaProducer</span><span style="color: #666666">{</span>
 <span style="color: #007020; font-weight: bold">def</span> send<span style="color: #666666">(</span>eventContent<span style="color: #007020; font-weight: bold">:</span> <span style="color: #902000">String</span><span style="color: #666666">)</span><span style="color: #007020; font-weight: bold">:</span> <span style="color: #902000">Unit</span> <span style="color: #666666">=</span> println<span style="color: #666666">(</span>s<span style="color: #4070a0">&quot;sending to Kafka: $eventContent&quot;</span><span style="color: #666666">)</span>
<span style="color: #666666">}</span>
<span style="color: #007020; font-weight: bold">object</span> <span style="color: #0e84b5; font-weight: bold">Monitor</span><span style="color: #666666">{</span>
 <span style="color: #007020; font-weight: bold">def</span> incrementCounter<span style="color: #666666">(</span>counterName<span style="color: #007020; font-weight: bold">:</span> <span style="color: #902000">String</span><span style="color: #666666">,</span> tags<span style="color: #007020; font-weight: bold">:</span> <span style="color: #666666">(</span><span style="color: #902000">String</span><span style="color: #666666">,</span> <span style="color: #902000">String</span><span style="color: #666666">))</span><span style="color: #007020; font-weight: bold">:</span> <span style="color: #902000">Unit</span> <span style="color: #666666">=</span> println<span style="color: #666666">(</span>s<span style="color: #4070a0">&quot;incrementing counter $counterName&quot;</span><span style="color: #666666">)</span>
<span style="color: #666666">}</span>
<span style="color: #007020; font-weight: bold">object</span> <span style="color: #0e84b5; font-weight: bold">Logger</span><span style="color: #666666">{</span>
 <span style="color: #007020; font-weight: bold">def</span> log<span style="color: #666666">(</span>event<span style="color: #007020; font-weight: bold">:</span> <span style="color: #902000">String</span><span style="color: #666666">)</span><span style="color: #007020; font-weight: bold">:</span> <span style="color: #902000">Unit</span> <span style="color: #666666">=</span> println<span style="color: #666666">(</span>s<span style="color: #4070a0">&quot;error: $event&quot;</span><span style="color: #666666">)</span>
<span style="color: #666666">}</span>
<span style="color: #007020; font-weight: bold">object</span> <span style="color: #0e84b5; font-weight: bold">S3_Client</span> <span style="color: #666666">{</span>
 <span style="color: #007020; font-weight: bold">def</span> upload<span style="color: #666666">(</span>eventContent<span style="color: #007020; font-weight: bold">:</span> <span style="color: #902000">String</span><span style="color: #666666">)</span><span style="color: #007020; font-weight: bold">:</span> <span style="color: #902000">Unit</span> <span style="color: #666666">=</span> println<span style="color: #666666">(</span>s<span style="color: #4070a0">&quot;uploading event $eventContent to S3&quot;</span><span style="color: #666666">)</span>
<span style="color: #666666">}</span>
</pre></div>

<h3 id="step-by-step-implementation-using-stackable-traits"><strong>Step by step implementation, using stackable-traits</strong></h3>

<h5 id="create-traits-that-represent-the-subscribers-and-mix-them">Create traits that represent the subscribers and mix them.</h5>

<p>We’ll create the following traits, each represent a subscriber for an error event</p>

<!-- HTML generated using hilite.me -->
<div style="background: #f0f0f0; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #007020; font-weight: bold">trait</span> <span style="color: #0e84b5; font-weight: bold">Log</span>
<span style="color: #007020; font-weight: bold">trait</span> <span style="color: #0e84b5; font-weight: bold">Metric</span>
<span style="color: #007020; font-weight: bold">trait</span> <span style="color: #0e84b5; font-weight: bold">S3_Backup</span>
<span style="color: #007020; font-weight: bold">trait</span> <span style="color: #0e84b5; font-weight: bold">Kafka</span>
</pre></div>

<p>And mix them to the Error classes. Here, we use Scala type system to describe the Error classes, and the actions that need to be taken.</p>

<!-- HTML generated using hilite.me -->
<div style="background: #f0f0f0; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #007020; font-weight: bold">trait</span> <span style="color: #0e84b5; font-weight: bold">ServingError</span><span style="color: #666666">{</span>
 <span style="color: #007020; font-weight: bold">val</span> code<span style="color: #007020; font-weight: bold">:</span> <span style="color: #902000">Int</span>
 <span style="color: #007020; font-weight: bold">val</span> description<span style="color: #007020; font-weight: bold">:</span> <span style="color: #902000">String</span>
<span style="color: #666666">}</span>
</pre></div>

<h5 id="turn-the-traits-into-services-that-activates-the-clients">Turn the traits into services that activates the Clients</h5>

<p>Now it is clear which subscribers should receive a notification on error. We will enrich the traits so they would be able to activate the clients as well:</p>

<!-- HTML generated using hilite.me -->
<div style="background: #f0f0f0; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #007020; font-weight: bold">abstract</span> <span style="color: #007020; font-weight: bold">class</span> <span style="color: #0e84b5; font-weight: bold">Sender</span> <span style="color: #666666">{</span>
 <span style="color: #007020; font-weight: bold">def</span> send<span style="color: #666666">(</span>event<span style="color: #007020; font-weight: bold">:</span> <span style="color: #902000">ServingError</span><span style="color: #666666">)</span><span style="color: #007020; font-weight: bold">:</span> <span style="color: #902000">Unit</span>
<span style="color: #666666">}</span>
<span style="color: #007020; font-weight: bold">trait</span> <span style="color: #0e84b5; font-weight: bold">Log</span> <span style="color: #007020; font-weight: bold">extends</span> <span style="color: #0e84b5; font-weight: bold">Sender</span> <span style="color: #666666">{</span>
 <span style="color: #007020; font-weight: bold">override</span> <span style="color: #007020; font-weight: bold">def</span> send<span style="color: #666666">(</span>event<span style="color: #007020; font-weight: bold">:</span> <span style="color: #902000">ServingError</span><span style="color: #666666">)</span><span style="color: #007020; font-weight: bold">:</span> <span style="color: #902000">Unit</span> <span style="color: #666666">=</span> <span style="color: #666666">{</span>
   <span style="color: #0e84b5; font-weight: bold">Logger</span><span style="color: #666666">.</span>log<span style="color: #666666">(</span>event<span style="color: #666666">.</span>description<span style="color: #666666">)</span>
 <span style="color: #666666">}</span>
<span style="color: #666666">}</span>
<span style="color: #007020; font-weight: bold">trait</span> <span style="color: #0e84b5; font-weight: bold">Metric</span> <span style="color: #007020; font-weight: bold">extends</span> <span style="color: #0e84b5; font-weight: bold">Sender</span> <span style="color: #666666">{</span>
 <span style="color: #007020; font-weight: bold">override</span> <span style="color: #007020; font-weight: bold">def</span> send<span style="color: #666666">(</span>event<span style="color: #007020; font-weight: bold">:</span> <span style="color: #902000">ServingError</span><span style="color: #666666">)</span><span style="color: #007020; font-weight: bold">:</span> <span style="color: #902000">Unit</span> <span style="color: #666666">=</span> <span style="color: #666666">{</span>
   <span style="color: #0e84b5; font-weight: bold">Monitor</span><span style="color: #666666">.</span>incrementCounter<span style="color: #666666">(</span>event<span style="color: #666666">.</span>getClass<span style="color: #666666">.</span>getSimpleName<span style="color: #60a0b0; font-style: italic">/*this is not recommended...*/</span><span style="color: #666666">,</span> <span style="color: #4070a0">&quot;errorCode&quot;</span> <span style="color: #666666">-&gt;</span>
   event<span style="color: #666666">.</span>code<span style="color: #666666">.</span>toString<span style="color: #666666">)</span>
 <span style="color: #666666">}</span>
<span style="color: #666666">}</span>
<span style="color: #007020; font-weight: bold">trait</span> <span style="color: #0e84b5; font-weight: bold">S3_Backup</span> <span style="color: #007020; font-weight: bold">extends</span> <span style="color: #0e84b5; font-weight: bold">Sender</span> <span style="color: #666666">{</span>
 <span style="color: #007020; font-weight: bold">override</span> <span style="color: #007020; font-weight: bold">def</span> send<span style="color: #666666">(</span>event<span style="color: #007020; font-weight: bold">:</span> <span style="color: #902000">ServingError</span><span style="color: #666666">)</span><span style="color: #007020; font-weight: bold">:</span> <span style="color: #902000">Unit</span> <span style="color: #666666">=</span> <span style="color: #666666">{</span>
   S3_Client<span style="color: #666666">.</span>upload<span style="color: #666666">(</span>event<span style="color: #666666">.</span>content<span style="color: #666666">)</span>
 <span style="color: #666666">}</span>
<span style="color: #666666">}</span>
<span style="color: #007020; font-weight: bold">trait</span> <span style="color: #0e84b5; font-weight: bold">Kafka</span> <span style="color: #007020; font-weight: bold">extends</span> <span style="color: #0e84b5; font-weight: bold">Sender</span> <span style="color: #666666">{</span>
 <span style="color: #007020; font-weight: bold">def</span> send<span style="color: #666666">(</span>event<span style="color: #007020; font-weight: bold">:</span> <span style="color: #902000">ServingError</span><span style="color: #666666">)</span><span style="color: #007020; font-weight: bold">:</span> <span style="color: #902000">Unit</span> <span style="color: #666666">=</span> <span style="color: #666666">{</span>
   <span style="color: #0e84b5; font-weight: bold">KafkaProducer</span><span style="color: #666666">.</span>send<span style="color: #666666">(</span>event<span style="color: #666666">.</span>content<span style="color: #666666">)</span> <span style="color: #666666">}</span>
<span style="color: #666666">}</span>
</pre></div>

<p>Alright, so now each trait have a “send” method that handles the event using the appropriate client.</p>

<p>But we still need to trigger it on error, and call them in the order described above</p>

<h5 id="stack-the-services-traits-with-each-other">‘Stack’ the services traits with each other</h5>

<p>I.e., Pipe of calls for the ‘send’ method in the services. As discussed, we’ll need to use super method calls for that.</p>

<p>Note that at this step we won’t be stacking modifications, but the side-effects that triggered on error.</p>

<p>Alright so we need to stack the traits according to the order and logic defined in the narrative described above. The order of the invocation of the traits will be right to left.</p>

<p>Hence the order for FatalError: S3_Backup ← Kafka ← Monitor ← Log</p>

<p>Where S3_Backup should be invoked only when the Kafka-Producer failed to send the event to Kafka.</p>

<p>And for InvalidRequestError: Kafka ← Monitor ← Log</p>

<p>Let’s re-arranged the mixing on the Error classes:</p>

<!-- HTML generated using hilite.me -->
<div style="background: #f0f0f0; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #007020; font-weight: bold">case</span> <span style="color: #007020; font-weight: bold">class</span> <span style="color: #0e84b5; font-weight: bold">FatalError</span><span style="color: #666666">(</span><span style="color: #007020; font-weight: bold">override</span> <span style="color: #007020; font-weight: bold">val</span> code<span style="color: #007020; font-weight: bold">:</span> <span style="color: #902000">Int</span> <span style="color: #666666">=</span> <span style="color: #40a070">1</span><span style="color: #666666">,</span> exceptionCause<span style="color: #007020; font-weight: bold">:</span> <span style="color: #902000">String</span><span style="color: #666666">)</span> <span style="color: #007020; font-weight: bold">extends</span> <span style="color: #0e84b5; font-weight: bold">ServingError</span> <span style="color: #007020; font-weight: bold">with</span> S3_Backup <span style="color: #007020; font-weight: bold">with</span> <span style="color: #0e84b5; font-weight: bold">Kafka</span> <span style="color: #007020; font-weight: bold">with</span> <span style="color: #0e84b5; font-weight: bold">Monitor</span> <span style="color: #007020; font-weight: bold">with</span> <span style="color: #0e84b5; font-weight: bold">Log</span><span style="color: #666666">{</span>
 <span style="color: #007020; font-weight: bold">override</span> <span style="color: #007020; font-weight: bold">val</span> description<span style="color: #007020; font-weight: bold">:</span> <span style="color: #902000">String</span> <span style="color: #666666">=</span> s<span style="color: #4070a0">&quot;Fatal Error code $code accrued&quot;</span>
<span style="color: #666666">}</span>
<span style="color: #007020; font-weight: bold">case</span> <span style="color: #007020; font-weight: bold">class</span> <span style="color: #0e84b5; font-weight: bold">InvalidRequestError</span><span style="color: #666666">(</span>paramName<span style="color: #007020; font-weight: bold">:</span> <span style="color: #902000">String</span><span style="color: #666666">,</span> paramValue<span style="color: #007020; font-weight: bold">:</span> <span style="color: #902000">String</span><span style="color: #666666">,</span> <span style="color: #007020; font-weight: bold">override</span> <span style="color: #007020; font-weight: bold">val</span> code<span style="color: #007020; font-weight: bold">:</span> <span style="color: #902000">Int</span> <span style="color: #666666">=</span> <span style="color: #40a070">2</span><span style="color: #666666">)</span> <span style="color: #007020; font-weight: bold">extends</span> <span style="color: #0e84b5; font-weight: bold">ServingError</span> <span style="color: #007020; font-weight: bold">with</span> <span style="color: #0e84b5; font-weight: bold">Kafka</span> <span style="color: #007020; font-weight: bold">with</span> <span style="color: #0e84b5; font-weight: bold">Monitoring</span> <span style="color: #007020; font-weight: bold">with</span> <span style="color: #0e84b5; font-weight: bold">Log</span><span style="color: #666666">{</span>
 <span style="color: #007020; font-weight: bold">override</span> <span style="color: #007020; font-weight: bold">val</span> description<span style="color: #007020; font-weight: bold">:</span> <span style="color: #902000">String</span> <span style="color: #666666">=</span> s<span style="color: #4070a0">&quot;Invalid Request. Bad  parameter: $paramName&quot;</span> <span style="color: #666666">+</span> <span style="color: #4070a0">&quot; &quot;</span> <span style="color: #666666">+</span> s<span style="color: #4070a0">&quot;with value: $paramValue&quot;</span>
<span style="color: #666666">}</span>
<span style="color: #007020; font-weight: bold">case</span> <span style="color: #007020; font-weight: bold">class</span> <span style="color: #0e84b5; font-weight: bold">FatalError</span><span style="color: #666666">(</span><span style="color: #007020; font-weight: bold">override</span> <span style="color: #007020; font-weight: bold">val</span> code<span style="color: #007020; font-weight: bold">:</span> <span style="color: #902000">Int</span> <span style="color: #666666">=</span> <span style="color: #40a070">1</span><span style="color: #666666">,</span> exceptionCause<span style="color: #007020; font-weight: bold">:</span> <span style="color: #902000">String</span><span style="color: #666666">)</span> <span style="color: #007020; font-weight: bold">extends</span> <span style="color: #0e84b5; font-weight: bold">ServingError</span> <span style="color: #007020; font-weight: bold">with</span> S3_Backup <span style="color: #007020; font-weight: bold">with</span> <span style="color: #0e84b5; font-weight: bold">Kafka</span> <span style="color: #007020; font-weight: bold">with</span> <span style="color: #0e84b5; font-weight: bold">Monitor</span> <span style="color: #007020; font-weight: bold">with</span> <span style="color: #0e84b5; font-weight: bold">Log</span><span style="color: #666666">{</span>
 <span style="color: #007020; font-weight: bold">override</span> <span style="color: #007020; font-weight: bold">val</span> description<span style="color: #007020; font-weight: bold">:</span> <span style="color: #902000">String</span> <span style="color: #666666">=</span> s<span style="color: #4070a0">&quot;Fatal Error code $code accrued&quot;</span>
<span style="color: #666666">}</span>
<span style="color: #007020; font-weight: bold">case</span> <span style="color: #007020; font-weight: bold">class</span> <span style="color: #0e84b5; font-weight: bold">InvalidRequestError</span><span style="color: #666666">(</span>paramName<span style="color: #007020; font-weight: bold">:</span> <span style="color: #902000">String</span><span style="color: #666666">,</span> paramValue<span style="color: #007020; font-weight: bold">:</span> <span style="color: #902000">String</span><span style="color: #666666">,</span> <span style="color: #007020; font-weight: bold">override</span> <span style="color: #007020; font-weight: bold">val</span> code<span style="color: #007020; font-weight: bold">:</span> <span style="color: #902000">Int</span> <span style="color: #666666">=</span> <span style="color: #40a070">2</span><span style="color: #666666">)</span> <span style="color: #007020; font-weight: bold">extends</span> <span style="color: #0e84b5; font-weight: bold">ServingError</span> <span style="color: #007020; font-weight: bold">with</span> <span style="color: #0e84b5; font-weight: bold">Kafka</span> <span style="color: #007020; font-weight: bold">with</span> <span style="color: #0e84b5; font-weight: bold">Monitoring</span> <span style="color: #007020; font-weight: bold">with</span> <span style="color: #0e84b5; font-weight: bold">Log</span><span style="color: #666666">{</span>
 <span style="color: #007020; font-weight: bold">override</span> <span style="color: #007020; font-weight: bold">val</span> description<span style="color: #007020; font-weight: bold">:</span> <span style="color: #902000">String</span> <span style="color: #666666">=</span> s<span style="color: #4070a0">&quot;Invalid Request. Bad  parameter: $paramName&quot;</span> <span style="color: #666666">+</span> <span style="color: #4070a0">&quot; &quot;</span> <span style="color: #666666">+</span> s<span style="color: #4070a0">&quot;with value: $paramValue&quot;</span>
<span style="color: #666666">}</span>
</pre></div>

<p>And stack the traits:</p>

<!-- HTML generated using hilite.me -->
<div style="background: #f0f0f0; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #007020; font-weight: bold">trait</span> <span style="color: #0e84b5; font-weight: bold">Log</span> <span style="color: #007020; font-weight: bold">extends</span> <span style="color: #0e84b5; font-weight: bold">Sender</span> <span style="color: #666666">{</span>
 <span style="color: #007020; font-weight: bold">abstract</span> <span style="color: #007020; font-weight: bold">override</span> <span style="color: #007020; font-weight: bold">def</span> send<span style="color: #666666">(</span>event<span style="color: #007020; font-weight: bold">:</span> <span style="color: #902000">ServingError</span><span style="color: #666666">)</span><span style="color: #007020; font-weight: bold">:</span> <span style="color: #902000">Unit</span> <span style="color: #666666">=</span> <span style="color: #666666">{</span>
   <span style="color: #0e84b5; font-weight: bold">Logger</span><span style="color: #666666">.</span>log<span style="color: #666666">(</span>event<span style="color: #666666">.</span>description<span style="color: #666666">)</span>
   <span style="color: #007020; font-weight: bold">super</span><span style="color: #666666">.</span>send<span style="color: #666666">(</span>event<span style="color: #666666">)</span>
 <span style="color: #666666">}</span>
<span style="color: #666666">}</span>
<span style="color: #007020; font-weight: bold">trait</span> <span style="color: #0e84b5; font-weight: bold">Metric</span> <span style="color: #007020; font-weight: bold">extends</span> <span style="color: #0e84b5; font-weight: bold">Sender</span> <span style="color: #666666">{</span>
 <span style="color: #007020; font-weight: bold">abstract</span> <span style="color: #007020; font-weight: bold">override</span> <span style="color: #007020; font-weight: bold">def</span> send<span style="color: #666666">(</span>event<span style="color: #007020; font-weight: bold">:</span> <span style="color: #902000">ServingError</span><span style="color: #666666">)</span><span style="color: #007020; font-weight: bold">:</span> <span style="color: #902000">Unit</span> <span style="color: #666666">=</span> <span style="color: #666666">{</span>
   <span style="color: #0e84b5; font-weight: bold">Monitor</span><span style="color: #666666">.</span>incrementCounter<span style="color: #666666">(</span>event<span style="color: #666666">.</span>getClass<span style="color: #666666">.</span>getSimpleName<span style="color: #666666">,</span> <span style="color: #4070a0">&quot;errorCode&quot;</span> <span style="color: #666666">-&gt;</span> event<span style="color: #666666">.</span>code<span style="color: #666666">.</span>toString<span style="color: #666666">)</span>
   <span style="color: #007020; font-weight: bold">super</span><span style="color: #666666">.</span>send<span style="color: #666666">(</span>event<span style="color: #666666">)</span>
 <span style="color: #666666">}</span>
<span style="color: #666666">}</span>
<span style="color: #007020; font-weight: bold">trait</span> <span style="color: #0e84b5; font-weight: bold">S3_Backup</span> <span style="color: #007020; font-weight: bold">extends</span> <span style="color: #0e84b5; font-weight: bold">Sender</span> <span style="color: #666666">{</span>
 <span style="color: #007020; font-weight: bold">abstract</span> <span style="color: #007020; font-weight: bold">override</span> <span style="color: #007020; font-weight: bold">def</span> send<span style="color: #666666">(</span>event<span style="color: #007020; font-weight: bold">:</span> <span style="color: #902000">ServingError</span><span style="color: #666666">)</span><span style="color: #007020; font-weight: bold">:</span> <span style="color: #902000">Unit</span> <span style="color: #666666">=</span> <span style="color: #666666">{</span>
   S3_Client<span style="color: #666666">.</span>upload<span style="color: #666666">(</span>event<span style="color: #666666">.</span>content<span style="color: #666666">)</span>
   <span style="color: #007020; font-weight: bold">super</span><span style="color: #666666">.</span>send<span style="color: #666666">(</span>event<span style="color: #666666">)</span>
 <span style="color: #666666">}</span>
<span style="color: #666666">}</span>
<span style="color: #007020; font-weight: bold">trait</span> <span style="color: #0e84b5; font-weight: bold">Kafka</span> <span style="color: #007020; font-weight: bold">extends</span> <span style="color: #0e84b5; font-weight: bold">Sender</span> <span style="color: #666666">{</span>
 <span style="color: #007020; font-weight: bold">abstract</span> <span style="color: #007020; font-weight: bold">override</span> <span style="color: #007020; font-weight: bold">def</span> send<span style="color: #666666">(</span>event<span style="color: #007020; font-weight: bold">:</span> <span style="color: #902000">ServingError</span><span style="color: #666666">)</span><span style="color: #007020; font-weight: bold">:</span> <span style="color: #902000">Unit</span> <span style="color: #666666">=</span> <span style="color: #666666">{</span>
   <span style="color: #0e84b5; font-weight: bold">Try</span><span style="color: #666666">(</span><span style="color: #0e84b5; font-weight: bold">KafkaProducer</span><span style="color: #666666">.</span>send<span style="color: #666666">(</span>event<span style="color: #666666">.</span>content<span style="color: #666666">)).</span>getOrElse<span style="color: #666666">(</span><span style="color: #007020; font-weight: bold">super</span><span style="color: #666666">.</span>send<span style="color: #666666">(</span>event<span style="color: #666666">))</span>
 <span style="color: #666666">}</span>
<span style="color: #666666">}</span>
</pre></div>

<p>You might notice that</p>

<ol>
  <li>
    <p>The call ‘super.send(event)’ was added to ‘send’ method.</p>
  </li>
  <li>
    <p>The ‘override’ modifier changed to <em>‘abstract override’</em>, because the send method now overrides the behavior but also calls for an abstract method with super.send. The modifier tells that this trait has to be mixed with a concrete class(later…).</p>

    <p>btw, If we’ll omit the ‘abstract’ from the modifier, we’ll get the following error:</p>

    <p><em>“method send in class Sender is accessed from super. It may not be abstract unless it is overridden by a member declared ‘abstract’ and `override’ super.send(event)”</em></p>
  </li>
  <li>
    <p>Kafka would call super, i.e. S3-Backup would be invoked only when KafkaProducer fails to deliver.</p>
  </li>
</ol>

<p><img align="right" src="/img/stack-traits.jpg" /></p>

<h5 id="create-and-stack-modification-traits">Create and ‘Stack’ modification traits:</h5>

<p>The event’s content that needs to be modified to be in the right format (json, csv) before sent as an input to KafkaProducer and S3. A Fatal error needs to be sent with a timestamp</p>

<p>Let’s write the modification method and the stackable modification traits:</p>

<!-- HTML generated using hilite.me -->
<div style="background: #f0f0f0; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #007020; font-weight: bold">object</span> <span style="color: #0e84b5; font-weight: bold">ServingError</span><span style="color: #666666">{</span>
<span style="color: #60a0b0; font-style: italic">// we are adding a method modification content method, to be used by the modification traits </span>
 <span style="color: #007020; font-weight: bold">def</span> modifyContent<span style="color: #666666">(</span>error<span style="color: #007020; font-weight: bold">:</span> <span style="color: #902000">ServingError</span><span style="color: #666666">,</span> content<span style="color: #007020; font-weight: bold">:</span> <span style="color: #902000">String</span><span style="color: #666666">)</span><span style="color: #007020; font-weight: bold">:</span> <span style="color: #902000">ServingError</span> <span style="color: #666666">=</span> <span style="color: #666666">{</span>
   error <span style="color: #007020; font-weight: bold">match</span> <span style="color: #666666">{</span>
     <span style="color: #007020; font-weight: bold">case</span> f<span style="color: #007020; font-weight: bold">:</span> <span style="color: #902000">FatalError</span> <span style="color: #666666">=&gt;</span> <span style="color: #0e84b5; font-weight: bold">FatalError</span><span style="color: #666666">(</span>exceptionCause <span style="color: #007020; font-weight: bold">=</span> f<span style="color: #666666">.</span>exceptionCause<span style="color: #666666">,</span> content <span style="color: #007020; font-weight: bold">=</span> content<span style="color: #666666">)</span>
     <span style="color: #007020; font-weight: bold">case</span> i<span style="color: #007020; font-weight: bold">:</span> <span style="color: #902000">InvalidRequestError</span> <span style="color: #666666">=&gt;</span> <span style="color: #0e84b5; font-weight: bold">InvalidRequestError</span><span style="color: #666666">(</span>i<span style="color: #666666">.</span>paramName<span style="color: #666666">,</span> i<span style="color: #666666">.</span>paramValue<span style="color: #666666">,</span> content <span style="color: #007020; font-weight: bold">=</span> content<span style="color: #666666">)</span>
   <span style="color: #666666">}</span>
 <span style="color: #666666">}</span>
<span style="color: #666666">}</span>

<span style="color: #007020; font-weight: bold">trait</span> <span style="color: #0e84b5; font-weight: bold">JsonTransformer</span> <span style="color: #007020; font-weight: bold">extends</span> <span style="color: #0e84b5; font-weight: bold">Sender</span> <span style="color: #666666">{</span>
 <span style="color: #007020; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">ServingError._</span>
 <span style="color: #007020; font-weight: bold">abstract</span> <span style="color: #007020; font-weight: bold">override</span> <span style="color: #007020; font-weight: bold">def</span> send<span style="color: #666666">(</span>event<span style="color: #007020; font-weight: bold">:</span> <span style="color: #902000">ServingError</span><span style="color: #666666">)</span><span style="color: #007020; font-weight: bold">:</span> <span style="color: #902000">Unit</span> <span style="color: #666666">=</span> <span style="color: #666666">{</span>
   <span style="color: #007020; font-weight: bold">super</span><span style="color: #666666">.</span>send<span style="color: #666666">(</span>modifyContent<span style="color: #666666">(</span>event<span style="color: #666666">,</span> <span style="color: #666666">{</span>
     <span style="color: #007020; font-weight: bold">val</span> date <span style="color: #007020; font-weight: bold">=</span> event <span style="color: #007020; font-weight: bold">match</span> <span style="color: #666666">{</span>
       <span style="color: #007020; font-weight: bold">case</span> d<span style="color: #007020; font-weight: bold">:</span> <span style="color: #902000">DateTimestampedMessage</span> <span style="color: #666666">=&gt;</span> <span style="color: #4070a0">&quot;\&quot;date\&quot;:&quot;</span> <span style="color: #666666">+</span> d<span style="color: #666666">.</span>date
       <span style="color: #007020; font-weight: bold">case</span> <span style="color: #007020; font-weight: bold">_</span> <span style="color: #007020; font-weight: bold">=&gt;</span> <span style="color: #4070a0">&quot;&quot;</span>
     <span style="color: #666666">}</span>
     <span style="color: #007020; font-weight: bold">val</span> cause <span style="color: #007020; font-weight: bold">=</span> event <span style="color: #007020; font-weight: bold">match</span> <span style="color: #666666">{</span>
       <span style="color: #007020; font-weight: bold">case</span> f<span style="color: #007020; font-weight: bold">:</span> <span style="color: #902000">FatalError</span> <span style="color: #666666">=&gt;</span> <span style="color: #4070a0">&quot;\&quot;cause\&quot;:&quot;</span> <span style="color: #666666">+</span> f<span style="color: #666666">.</span>exceptionCause
       <span style="color: #007020; font-weight: bold">case</span> i<span style="color: #007020; font-weight: bold">:</span> <span style="color: #902000">InvalidRequestError</span> <span style="color: #666666">=&gt;</span> <span style="color: #4070a0">&quot;\&quot;cause\&quot;:&quot;</span> <span style="color: #666666">+</span> i<span style="color: #666666">.</span>paramName <span style="color: #666666">+</span><span style="color: #4070a0">&quot;:&quot;</span> <span style="color: #666666">+</span>i<span style="color: #666666">.</span>paramValue
     <span style="color: #666666">}</span>
     s<span style="color: #4070a0">&quot;&quot;&quot;</span>
<span style="color: #4070a0">             {</span>
<span style="color: #4070a0">                &quot;code:&quot;${event.code},</span>
<span style="color: #4070a0">                $date</span>
<span style="color: #4070a0">                $cause</span>
<span style="color: #4070a0">             }</span>
<span style="color: #4070a0">      &quot;&quot;&quot;</span>
   <span style="color: #666666">}))</span>
 <span style="color: #666666">}</span>
<span style="color: #666666">}</span>
<span style="color: #007020; font-weight: bold">trait</span> <span style="color: #0e84b5; font-weight: bold">CsVTransformer</span> <span style="color: #007020; font-weight: bold">extends</span> <span style="color: #0e84b5; font-weight: bold">Sender</span> <span style="color: #666666">{</span>
 <span style="color: #007020; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">ServingError._</span>
 <span style="color: #007020; font-weight: bold">abstract</span> <span style="color: #007020; font-weight: bold">override</span> <span style="color: #007020; font-weight: bold">def</span> send<span style="color: #666666">(</span>event<span style="color: #007020; font-weight: bold">:</span> <span style="color: #902000">ServingError</span><span style="color: #666666">)</span><span style="color: #007020; font-weight: bold">:</span> <span style="color: #902000">Unit</span> <span style="color: #666666">=</span> <span style="color: #666666">{</span>
   <span style="color: #007020; font-weight: bold">super</span><span style="color: #666666">.</span>send<span style="color: #666666">(</span>modifyContent<span style="color: #666666">(</span>event<span style="color: #666666">,</span> <span style="color: #666666">{</span>
     <span style="color: #007020; font-weight: bold">val</span> date <span style="color: #007020; font-weight: bold">=</span> event <span style="color: #007020; font-weight: bold">match</span> <span style="color: #666666">{</span>
       <span style="color: #007020; font-weight: bold">case</span> d<span style="color: #007020; font-weight: bold">:</span> <span style="color: #902000">DateTimestampedMessage</span> <span style="color: #666666">=&gt;</span> d<span style="color: #666666">.</span>date
       <span style="color: #007020; font-weight: bold">case</span> <span style="color: #007020; font-weight: bold">_</span> <span style="color: #007020; font-weight: bold">=&gt;</span> <span style="color: #4070a0">&quot;&quot;</span>
     <span style="color: #666666">}</span>
     <span style="color: #007020; font-weight: bold">val</span> cause <span style="color: #007020; font-weight: bold">=</span> event <span style="color: #007020; font-weight: bold">match</span> <span style="color: #666666">{</span>
       <span style="color: #007020; font-weight: bold">case</span> f<span style="color: #007020; font-weight: bold">:</span> <span style="color: #902000">FatalError</span> <span style="color: #666666">=&gt;</span> f<span style="color: #666666">.</span>exceptionCause
       <span style="color: #007020; font-weight: bold">case</span> i<span style="color: #007020; font-weight: bold">:</span> <span style="color: #902000">InvalidRequestError</span> <span style="color: #666666">=&gt;</span> i<span style="color: #666666">.</span>paramName <span style="color: #666666">+</span><span style="color: #4070a0">&quot;,&quot;</span> <span style="color: #666666">+</span>i<span style="color: #666666">.</span>paramValue
     <span style="color: #666666">}</span>
     s<span style="color: #4070a0">&quot;&quot;&quot;${event.code},$date$cause&quot;&quot;&quot;</span>
   <span style="color: #666666">}))</span>
 <span style="color: #666666">}</span>
<span style="color: #666666">}</span>

<span style="color: #007020; font-weight: bold">trait</span> <span style="color: #0e84b5; font-weight: bold">Timestamp</span> <span style="color: #666666">{</span>
 <span style="color: #007020; font-weight: bold">val</span> date<span style="color: #007020; font-weight: bold">:</span> <span style="color: #902000">Date</span> <span style="color: #666666">=</span> <span style="color: #007020; font-weight: bold">new</span> <span style="color: #0e84b5; font-weight: bold">Date</span><span style="color: #666666">()</span>
<span style="color: #666666">}</span>
</pre></div>

<p>And mix the modification traits to the error classes</p>

<!-- HTML generated using hilite.me -->
<div style="background: #f0f0f0; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #007020; font-weight: bold">case</span> <span style="color: #007020; font-weight: bold">class</span> <span style="color: #0e84b5; font-weight: bold">FatalError</span><span style="color: #666666">(</span><span style="color: #007020; font-weight: bold">override</span> <span style="color: #007020; font-weight: bold">val</span> code<span style="color: #007020; font-weight: bold">:</span> <span style="color: #902000">Int</span> <span style="color: #666666">=</span> <span style="color: #40a070">1</span><span style="color: #666666">,</span> exceptionCause<span style="color: #007020; font-weight: bold">:</span> <span style="color: #902000">String</span><span style="color: #666666">,</span> content<span style="color: #007020; font-weight: bold">:</span> <span style="color: #902000">String</span> <span style="color: #666666">=</span> <span style="color: #4070a0">&quot;&quot;</span><span style="color: #666666">)</span> <span style="color: #007020; font-weight: bold">extends</span> <span style="color: #0e84b5; font-weight: bold">ServingError</span> <span style="color: #007020; font-weight: bold">with</span> S3_Backup <span style="color: #007020; font-weight: bold">with</span> <span style="color: #0e84b5; font-weight: bold">CsVTransformer</span> <span style="color: #007020; font-weight: bold">with</span> <span style="color: #0e84b5; font-weight: bold">Kafka</span> <span style="color: #007020; font-weight: bold">with</span> <span style="color: #0e84b5; font-weight: bold">JsonTransformer</span> <span style="color: #007020; font-weight: bold">with</span> <span style="color: #0e84b5; font-weight: bold">Timestamp</span> <span style="color: #007020; font-weight: bold">with</span> <span style="color: #0e84b5; font-weight: bold">Metric</span> <span style="color: #007020; font-weight: bold">with</span> <span style="color: #0e84b5; font-weight: bold">Log</span><span style="color: #666666">{</span>
 <span style="color: #007020; font-weight: bold">override</span> <span style="color: #007020; font-weight: bold">val</span> description<span style="color: #007020; font-weight: bold">:</span> <span style="color: #902000">String</span> <span style="color: #666666">=</span> s<span style="color: #4070a0">&quot;Fatal Error code $code accrued&quot;</span>
<span style="color: #666666">}</span>
<span style="color: #007020; font-weight: bold">case</span> <span style="color: #007020; font-weight: bold">class</span> <span style="color: #0e84b5; font-weight: bold">InvalidRequestError</span><span style="color: #666666">(</span>paramName<span style="color: #007020; font-weight: bold">:</span> <span style="color: #902000">String</span><span style="color: #666666">,</span> paramValue<span style="color: #007020; font-weight: bold">:</span> <span style="color: #902000">String</span><span style="color: #666666">,</span> <span style="color: #007020; font-weight: bold">override</span> <span style="color: #007020; font-weight: bold">val</span> code<span style="color: #007020; font-weight: bold">:</span> <span style="color: #902000">Int</span> <span style="color: #666666">=</span> <span style="color: #40a070">2</span><span style="color: #666666">,</span> content<span style="color: #007020; font-weight: bold">:</span> <span style="color: #902000">String</span> <span style="color: #666666">=</span> <span style="color: #4070a0">&quot;&quot;</span><span style="color: #666666">)</span> <span style="color: #007020; font-weight: bold">extends</span> <span style="color: #0e84b5; font-weight: bold">ServingError</span> <span style="color: #007020; font-weight: bold">with</span> <span style="color: #0e84b5; font-weight: bold">Kafka</span> <span style="color: #007020; font-weight: bold">with</span> <span style="color: #0e84b5; font-weight: bold">JsonTransformer</span> <span style="color: #007020; font-weight: bold">with</span> <span style="color: #0e84b5; font-weight: bold">Log</span><span style="color: #666666">{</span>
 <span style="color: #007020; font-weight: bold">override</span> <span style="color: #007020; font-weight: bold">val</span> description<span style="color: #007020; font-weight: bold">:</span> <span style="color: #902000">String</span> <span style="color: #666666">=</span> s<span style="color: #4070a0">&quot;Invalid Request. Bad  parameter: $paramName&quot;</span> <span style="color: #666666">+</span> <span style="color: #4070a0">&quot; &quot;</span> <span style="color: #666666">+</span> s<span style="color: #4070a0">&quot;with value: $paramValue&quot;</span>
<span style="color: #666666">}</span>
</pre></div>

<h5 id="create-and-mix-servingerrorsender-">Create and mix ‘ServingErrorSender’ :</h5>

<p>Last, in order to trigger the error reports once an error object is created, we’ll mix them with a sending trait.</p>

<!-- HTML generated using hilite.me -->
<div style="background: #f0f0f0; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #007020; font-weight: bold">trait</span> <span style="color: #0e84b5; font-weight: bold">ServingErrorSender</span> <span style="color: #007020; font-weight: bold">extends</span> <span style="color: #0e84b5; font-weight: bold">Sender</span><span style="color: #666666">{</span>
 <span style="color: #007020; font-weight: bold">this:</span> <span style="color: #902000">ServingError</span> <span style="color: #666666">=&gt;</span>   <span style="color: #60a0b0; font-style: italic">// force to be mixed with a ServingError class, (look for 'see cake-pattern')</span>
 <span style="color: #007020; font-weight: bold">def</span> send<span style="color: #666666">()</span><span style="color: #007020; font-weight: bold">:</span> <span style="color: #902000">Unit</span> <span style="color: #666666">=</span> send<span style="color: #666666">(</span><span style="color: #007020; font-weight: bold">this</span><span style="color: #666666">)</span>
 <span style="color: #007020; font-weight: bold">override</span> <span style="color: #007020; font-weight: bold">def</span> send<span style="color: #666666">(</span>event<span style="color: #007020; font-weight: bold">:</span> <span style="color: #902000">ServingError</span><span style="color: #666666">)</span><span style="color: #007020; font-weight: bold">:</span> <span style="color: #902000">Unit</span> <span style="color: #666666">=</span> <span style="color: #4070a0">&quot;&quot;</span>
<span style="color: #666666">}</span>
</pre></div>

<!-- HTML generated using hilite.me -->
<div style="background: #f0f0f0; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #007020; font-weight: bold">trait</span> <span style="color: #0e84b5; font-weight: bold">ServingError</span> <span style="color: #007020; font-weight: bold">extends</span> <span style="color: #0e84b5; font-weight: bold">ServingErrorSender</span><span style="color: #666666">{</span>
 <span style="color: #007020; font-weight: bold">val</span> code<span style="color: #007020; font-weight: bold">:</span> <span style="color: #902000">Int</span>
 <span style="color: #007020; font-weight: bold">val</span> description<span style="color: #007020; font-weight: bold">:</span> <span style="color: #902000">String</span>
 <span style="color: #007020; font-weight: bold">val</span> content<span style="color: #007020; font-weight: bold">:</span> <span style="color: #902000">String</span>
<span style="color: #666666">}</span>
</pre></div>

<h3 id="try-it-out"><strong>Try it out</strong></h3>

<p>We have completed the task!</p>

<p>Now, when invoking a ‘send’’ for an error, like the following:</p>

<!-- HTML generated using hilite.me -->
<div style="background: #f0f0f0; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #0e84b5; font-weight: bold">FatalError</span><span style="color: #666666">(</span>exceptionCause <span style="color: #007020; font-weight: bold">=</span> <span style="color: #007020; font-weight: bold">new</span> <span style="color: #0e84b5; font-weight: bold">IllegalArgumentException</span><span style="color: #666666">().</span>getClass<span style="color: #666666">.</span>getSimpleName<span style="color: #666666">).</span>send<span style="color: #666666">()</span>
</pre></div>

<p>Results with the following printed to the log:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>error: Fatal Error code 1 accrued //Log
incrementing counter FatalError // Metric
sending to Kafka:  // Kafka
{
  "code:"1,
  "date":Thu Nov 30 16:56:33 IST 2017
  "cause":IllegalArgumentException
}
</code></pre></div></div>

<h3 id="next"><strong>Next</strong></h3>

<p>In <a href="https://fullgc.github.io/stackable-traits-pattern---part-2/">part-2</a> we’ll use stackable-actor traits for gathering actor’s metrics.</p>

<h3 id="references"><strong>References</strong></h3>

<p><em><a href="https://www.artima.com/shop/programming_in_scala_3ed">Programming in Scala(chapter 12.5) / Martin Odersky and co</a></em></p>

<hr />

<p><em>The complete source code and more running examples can be found in my <a href="https://github.com/FullGC/stackable-traits">github</a></em>.</p>

<div id="disqus_thread"></div>
<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
var disqus_config = function () {
this.page.url = "https://fullgc.github.io/stackable-traits-pattern/"
this.page.identifier = stackable-1
};
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://FullGC.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>

<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


              <hr>

              <div class="container">
    <div class="row ">
        <div class="col-xs-2"></div>
        <div class="col-xs-8">

        <!-- Google + -->
        <div class="g-plus" data-action="share" data-annotation="bubble"></div>
        <script src="https://apis.google.com/js/platform.js" async defer></script>

        <!-- Facebook -->
        <div class="fb-share-button" data-href="http://localhost:4000/stackable-traits-pattern/" data-layout="button_count" style="position: relative; top: -8px; left: 33px;"></div>
        <div id="fb-root"></div>
        <script>(function(d, s, id) {
          var js, fjs = d.getElementsByTagName(s)[0];
          if (d.getElementById(id)) return;
          js = d.createElement(s); js.id = id;
          js.src = "//connect.facebook.net/fr_FR/sdk.js#xfbml=1&appId=609039549219229&version=v2.0";
          fjs.parentNode.insertBefore(js, fjs);
        }(document, 'script', 'facebook-jssdk'));</script>

    </div>
    </div>
    <div class="col-xs-2"></div>
</div>

            </div>
        </div>
    </div>
</article>
<br>


<!--  Disqus comments -->
<!--


<hr>-->


    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    <li>
                        <a href="/feed.xml">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    
                    <li>
                        <a href="https://github.com/FullGC">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                </ul>
                <p class="copyright text-muted">Copyright &copy; FullGC 2017</p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="https://code.jquery.com/jquery-2.1.3.min.js"></script>

<!-- Bootstrap Core JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>

<!-- Custom Theme JavaScript -->
<script src="/js/clean-blog.js "></script>


</body>

</html>
